var BABYLONX;!function(e){var t=function(){function t(e,t,r){this._canvas=e,this._sizeField=t,this._outputPanel=r,this._sphereMaterials=[]}return t.prototype.run=function(){var t=this;this._outputPanel.style.display="none",this._bjs=new BABYLON.Engine(this._canvas),this.prepareScene(),new e.FilesInput(this._canvas,function(e){t.convert(e[0])})},t.prototype.prepareScene=function(){var e=this;this._scene=new BABYLON.Scene(this._bjs);var t=new BABYLON.ArcRotateCamera("Camera",Math.PI/2,1,110,BABYLON.Vector3.Zero(),this._scene);t.attachControl(this._canvas,!0);var r=(new BABYLON.PointLight("Omni",new BABYLON.Vector3(60,60,80),this._scene),new BABYLON.HDRCubeTexture("TextureSample/environment.babylon.hdr",this._scene)),o=BABYLON.Mesh.CreateBox("hdrSkyBox",1e3,this._scene);this._hdrSkyboxMaterial=new BABYLON.PBRMaterial("skyBox",this._scene),this._hdrSkyboxMaterial.backFaceCulling=!1,this._hdrSkyboxMaterial.reflectionTexture=r,this._hdrSkyboxMaterial.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,this._hdrSkyboxMaterial.microSurface=1,this._hdrSkyboxMaterial.disableLighting=!0,o.material=this._hdrSkyboxMaterial,o.infiniteDistance=!0;for(var n=function(t,o,n,i){var a=BABYLON.Mesh.CreateSphere("Sphere_x_"+t+"_z_"+o,10,9,e._scene);a.position.z=o,a.position.x=t;var s=new BABYLON.PBRMaterial("Material_x_"+t+"_z_"+o,e._scene);s.reflectionTexture=r,s.albedoColor=new BABYLON.Color3(.2,.9,1),s.reflectivityColor=new BABYLON.Color3(n,n,n),s.microSurface=i,s.usePhysicalLightFalloff=!1,a.material=s,e._sphereMaterials.push(s),a.renderingGroupId=1},i=38,a=0;6>a;a++){for(var s=a/5,l=-55,c=0;6>c;c++){var h=c/5;n(i,l,s,h),l+=15}i-=15}this._bjs.runRenderLoop(function(){e._scene.render()})},t.prototype.convert=function(e){var t=this;e&&e.toLowerCase().indexOf(".hdr")<=0||(this._outputPanel.style.display="block",setTimeout(function(){t.convertContent(e)},100))},t.prototype.convertContent=function(e){var t=this,r="file:"+e,o=this._sizeField.value,n=+o,i=function(r){var o=new Blob([r],{type:"application/octet-stream"}),n=window.URL.createObjectURL(o),i=new BABYLON.HDRCubeTexture(n,t._scene),a=t._hdrSkyboxMaterial.reflectionTexture;t._hdrSkyboxMaterial.reflectionTexture=i,t._hdrSkyboxMaterial.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,t._sphereMaterials.forEach(function(e){e.reflectionTexture=i}),a.dispose();var s=document.createElement("a");document.body.appendChild(s),s.style.display="none",s.href=n;var l=e.replace(".hdr",".babylon.hdr");s.download=l,s.click(),t._outputPanel.style.display="none"};BABYLON.HDRCubeTexture.generateBabylonHDR(r,n,i,function(){alert("An error occured during load.")})},t}();e.EnvironmentMapGenerator=t}(BABYLONX||(BABYLONX={}));var BABYLONX;!function(e){var t=function(){function e(e,t){var r=this;this._loadCallback=null,e&&(this._elementToMonitor=e,this._elementToMonitor.addEventListener("dragenter",function(e){r._drag(e)},!1),this._elementToMonitor.addEventListener("dragover",function(e){r._drag(e)},!1),this._elementToMonitor.addEventListener("drop",function(e){r._drop(e)},!1)),this._loadCallback=t}return e.prototype._drag=function(e){e.stopPropagation(),e.preventDefault()},e.prototype._drop=function(e){e.stopPropagation(),e.preventDefault(),this._loadFiles(e)},e.prototype._loadFiles=function(e){e&&e.dataTransfer&&e.dataTransfer.files&&(this._filesToLoad=e.dataTransfer.files),e&&e.target&&e.target.files&&(this._filesToLoad=e.target.files);var t=[];if(this._filesToLoad&&this._filesToLoad.length>0)for(var r=0;r<this._filesToLoad.length;r++)BABYLON.FilesInput.FilesToLoad[this._filesToLoad[r].name]=this._filesToLoad[r],t.push(this._filesToLoad[r].name);this._loadCallback&&this._loadCallback(t)},e}();e.FilesInput=t}(BABYLONX||(BABYLONX={}));